<!-- Creator     : groff version 1.21 -->
<!-- CreationDate: Mon Dec 12 13:48:48 2011 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>COROSYNC_OVERVIEW</title>

</head>
<body>

<h1 align="center">COROSYNC_OVERVIEW</h1>

<a href="#NAME">NAME</a><br>
<a href="#OVERVIEW">OVERVIEW</a><br>
<a href="#QUICKSTART">QUICKSTART</a><br>
<a href="#USING LIBRARIES">USING LIBRARIES</a><br>
<a href="#IPv6">IPv6</a><br>
<a href="#ARCHITECTURE">ARCHITECTURE</a><br>
<a href="#ENVIRONMENT VARIABLES">ENVIRONMENT VARIABLES</a><br>
<a href="#SECURITY">SECURITY</a><br>
<a href="#SAFTEST COMPLIANCE">SAFTEST COMPLIANCE</a><br>
<a href="#BUGS">BUGS</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">corosync_overview
&minus; Corosync overview</p>

<h2>OVERVIEW
<a name="OVERVIEW"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The corosync
project is a project to implement a production quality
&quot;Revised BSD&quot; licensed implementation of the most
recent SA Forum&rsquo;s Application Interface Specification.
The Application Interface Specification is a software API
and policies which are used to develop applications that
maintain service during faults. The API consists of
Availability Management Framework (AMF) which provides
application failover, Cluster Membership (CLM),
Checkpointing (CKPT), Eventing (EVT), Messaging (MSG), and
Distributed Locking (DLOCK).</p>

<p style="margin-left:11%; margin-top: 1em">Currently
Messaging is unimplemented.</p>

<p style="margin-left:11%; margin-top: 1em">Faults occur
for various reasons:</p>

<p style="margin-left:11%; margin-top: 1em">* Application
Faults</p>

<p style="margin-left:11%; margin-top: 1em">* Middleware
Faults</p>

<p style="margin-left:11%; margin-top: 1em">* Operating
System Faults</p>

<p style="margin-left:11%; margin-top: 1em">* Hardware
Faults</p>

<p style="margin-left:11%; margin-top: 1em">The major focus
of high availability in the past has been to mask hardware
faults. Faults in other components of the system have gone
unsolved until AIS. AIS can mask many types of faults in
applications, middleware, operating systems, or even
hardware by providing a simple framework for allowing
developers to create redundant applications. These redundant
applications can be distributed over multiple nodes such
that if any one node faults, another node can recover.</p>

<p style="margin-left:11%; margin-top: 1em">Application
programmers develop applications to periodically record
their state using the checkpointing service. When an active
application fails, a standby application recovers the state
of the application. This technique, called stateful
application failover, provides the fundamental difference
between corosync and other systems that have come before it.
With stateful application failover, the end-application user
doesn&rsquo;t have to reload the application or redial a
telephone. The full state is recorded, so the
end-application user sees no interruption in service.</p>

<p style="margin-left:11%; margin-top: 1em">Because
programmers can now distribute applications across multiple
processes or nodes, a mechanism must exist for them to
communicate. This mechanism is provided by two services. The
event service provides a publish/subscribe model for events.
The messaging service provides end to end messaging. Finally
a mechanism to synchronize access is provided by the
distributed lock service.</p>

<p style="margin-left:11%; margin-top: 1em">The corosync
project also provides a group messaging toolkit called EVS.
The EVS service implements a messaging model known as
Extended Virtual Synchrony. This model allows one sender to
transmit to many receivers. Certain guarantees are provided
for message and membership delivery which make virtual
synchrony ideal for developing distributed applications.</p>

<h2>QUICKSTART
<a name="QUICKSTART"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The corosync
executive must be configured. In the directory conf in the
source distribution are several files that must be copied to
the /etc/corosync directory. If corosync is packaged by a
distro, this may be complete.</p>

<p style="margin-left:11%; margin-top: 1em">The directory
contains the file corosync.conf. Please read the
corosync.conf(5) man page for details on the configuration
options. The corosync project will work out of the box with
the default configuration options, although the
administrator may desire different options.</p>

<p style="margin-left:11%; margin-top: 1em">The corosync
executive uses cryptographic techniques to ensure
authenticity and privacy of the messages. In order for
corosync to be secure and operate, a private key must be
generated and shared to all processors.</p>

<p style="margin-left:11%; margin-top: 1em">First generate
the key on one of the nodes:</p>

<p style="margin-left:11%; margin-top: 1em">unix#
corosync-keygen <br>
Corosync Cluster Engine Authentication key generator. <br>
Gathering 1024 bits for key from /dev/random. <br>
Press keys on your keyboard to generate entropy. <br>
Writing corosync key to /etc/corosync/authkey.</p>

<p style="margin-left:11%; margin-top: 1em">After this
operation, a private key will be in the file
/etc/corosync/authkey. This private key must be copied to
every processor in the cluster. If the private key
isn&rsquo;t the same for every node, those nodes with
nonmatching private keys will not be able to join the same
configuration.</p>

<p style="margin-left:11%; margin-top: 1em">Copy the key to
some security transportable storage or use ssh to transmit
the key from node to node. Then install the key with the
command:</p>

<p style="margin-left:11%; margin-top: 1em">unix#: install
-D --group=0 --owner=0 --mode=0400 /path_to_authkey/authkey
/etc/corosync/authkey</p>

<p style="margin-left:11%; margin-top: 1em">If a message
&quot;Invalid digest&quot; appears from the corosync
executive, the keys are not consistent between
processors.</p>

<p style="margin-left:11%; margin-top: 1em">Finally run the
corosync executive. If corosync is packaged from a distro,
it may be set to start on system start. It may also be
turned off by default in which case the init script for
corosync must be enabled.</p>

<p style="margin-left:11%; margin-top: 1em">After running
aisexec, a list of all processors IP addresses running the
corosync executive and configured on the same multicast
address will appear. If they don&rsquo;t appear, there may
be a problem with multicast in the distro or hardware. If
this happens, participation in the corosync mailing list may
help solve the problem. The email address is
openais@lists.osdl.org.</p>

<h2>USING LIBRARIES
<a name="USING LIBRARIES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The corosync
AIS libraries have header files which must be included in
the developer&rsquo;s application. Once the header file is
included, the developer can reference the AIS
interfaces.</p>

<p style="margin-left:11%; margin-top: 1em">The corosync
project recommends to distros to place include files in
/usr/include/corosync. The following include lines must be
added to the application to use each of the following
services:</p>

<p style="margin-left:11%; margin-top: 1em">#include
&lt;corosync/saClm.h&gt; For the Cluster Membership B.01.01
service.</p>

<p style="margin-left:11%; margin-top: 1em">#include
&lt;corosync/saCkpt.h&gt; For the Checkpointing B.01.01
service.</p>

<p style="margin-left:11%; margin-top: 1em">#include
&lt;corosync/saEvt.h&gt; For the Eventing B.01.01
service.</p>

<p style="margin-left:11%; margin-top: 1em">#include
&lt;corosync/ais_amf.h&gt; For the AMF A.01.01 service.</p>

<p style="margin-left:11%; margin-top: 1em">The corosync
project recommends to distros to place library files in
/usr/lib. The following link lines must be added to the
LDFLAGS section of the makefile.</p>

<p style="margin-left:11%; margin-top: 1em">-lsaClm For the
Cluster Membership B.01.01 service</p>

<p style="margin-left:11%; margin-top: 1em">-lsaCkpt For
the Checkpointing B.01.01 service</p>

<p style="margin-left:11%; margin-top: 1em">-lsaEvt For the
Eventing B.01.01 service</p>

<p style="margin-left:11%; margin-top: 1em">-lsaAmf For the
AMF A.01.01 service</p>

<p style="margin-left:11%; margin-top: 1em">-lais Specify
this to get access to all AIS libraries without specifying
each library individually.</p>

<h2>IPv6
<a name="IPv6"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The corosync
project supports both IPv4 and IPv6 network addresses. The
entire cluster must use either IPv4 or IPv6 for the cluster
communication mechanism. In order to use IPv6, IPv6
addresses must be specified in the bindnetaddr and mcastaddr
fields in the configuration file. The nodeid field must also
be set.</p>

<p style="margin-left:11%; margin-top: 1em">An example of
this is: nodeid: 2 bindnetaddr: fec0::1:a800:4ff:fe00:20
mcastaddr: ff05::1</p>

<p style="margin-left:11%; margin-top: 1em">To configure a
host for IPv6, use the ifconfig program to add interfaces:
box20: ifconfig eth0 add fec0::1:a800:4ff:fe00:20/64 box30:
ifconfig eth0 add fec0::1:a800:4ff:fe00:30/64</p>

<p style="margin-left:11%; margin-top: 1em">If the /64 is
not specified, a route for the IPv6 network will not be
configured which will cause significant problems. Make sure
a route is available for IPv6 traffic.</p>

<h2>ARCHITECTURE
<a name="ARCHITECTURE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The AIS
libraries are a thin IPC interface to the corosync
executive. The corosync executive provides services for the
SA Forum AIS libraries as well as the EVS and CPG
libraries.</p>

<p style="margin-left:11%; margin-top: 1em">The corosync
executive uses the Totem extended virtual synchrony
protocol. The advantage to the end user is excellent
performance characteristics and a proven protocol with
excellent reliability. This protocol connects the processors
in a configuration together so they may communicate.</p>

<h2>ENVIRONMENT VARIABLES
<a name="ENVIRONMENT VARIABLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The corosync
executive process uses four environment variables during
startup. If these environment variables are not set,
defaults will be used. <br>
COROSYNC_MAIN_CONFIG_FILE</p>

<p style="margin-left:22%;">This specifies the fully
qualified path to the corosync configuration file.</p>

<p style="margin-left:22%; margin-top: 1em">The default is
/etc/corosync/corosync.conf.</p>

<p style="margin-left:11%;">COROSYNC_AMF_CONFIG_FILE</p>

<p style="margin-left:22%;">This specifies the fully
qualified path to the corosync Availability Management
Framework configuration file.</p>

<p style="margin-left:22%; margin-top: 1em">The default is
/etc/corosync/amf.conf.</p>


<p style="margin-left:11%;">COROSYNC_DEFAULT_CONFIG_IFACE</p>

<p style="margin-left:22%;">This specifies the LCRSO that
is used to parse the configuration file. This allows other
configuration file parsers to be implemented within the
system.</p>

<p style="margin-left:22%; margin-top: 1em">The default is
to use the default corosync configuration file parser which
parses the format specified in corosync.conf (5).</p>


<p style="margin-left:11%;">COROSYNC_TOTEM_AUTHKEY_FILE</p>

<p style="margin-left:22%;">This specifies the fully
qualified path to the shared key used to authenticate and
encrypt data used within the Totem protocol.</p>

<p style="margin-left:22%; margin-top: 1em">The default is
/etc/corosync/authkey.</p>

<h2>SECURITY
<a name="SECURITY"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The corosync
executive optionally encrypts all messages sent over the
network using the SOBER-128 stream cipher. The corosync
executive uses HMAC and SHA1 to authenticate all messages.
The corosync executive library uses SOBER-128 as a pseudo
random number generator. The EVS library feeds the PRNG
using the /dev/random Linux device.</p>

<p style="margin-left:11%; margin-top: 1em">If membership
messages can be captured by intruders, it is possible to
execute a denial of service attack on the cluster. In this
scenario, the cluster is likely already compromised and a
DOS attack is the least of the administration&rsquo;s
worries.</p>

<p style="margin-left:11%; margin-top: 1em">The security in
corosync does not offer perfect forward secrecy because the
keys are reused. It may be possible for an intruder by
capturing packets in an automated fashion to determine the
shared key. No such automated attack has been published as
of yet. In this scenario, the cluster is likely already
compromised to allow the long-term capture of transmitted
data.</p>

<p style="margin-left:11%; margin-top: 1em">For security
reasons, the corosync executive binary should NEVER be
setuid or setgid in the filesystem.</p>

<h2>SAFTEST COMPLIANCE
<a name="SAFTEST COMPLIANCE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The corosync
libraries are now nearly compliant with every aspect of the
SA Forum&rsquo;s AIS specification. The AMF service,
however, is not compliant with the B.01.01 specification.
The remaining services pass most of the tests of the saftest
suite against the B.01.01 specification.</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The messaging
service is partially implemented and not suitable for
deployment. The distributed locking service is buggy and not
suitable for deployment. The Availability Management
Framework is under development and not suitable for
deployment..</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>corosync.conf</b>(5),
<b>corosync-keygen</b>(8), <b>evs_overview</b>(8)</p>
<hr>
</body>
</html>
